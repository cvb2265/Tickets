<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>Tickets</title>
<script th:src="@{/js/jquery.js}" type="text/javascript"></script>
<script th:inline="javascript">
/*<![CDATA[*/      //加上这些，否则如果js有大于号、小于号等会报SAX解析错误
	$(function () {
		var seat_table = $("#seat_table");
		var lists = [[${lists}]];
		$.each(lists, function(){
			var tr = $("<tr/>");//创建一个<tr/>元素
			var list=this;
			$.each(list, function(){
				if(!this.avail) {
					var td = $("<td/>");//创建一个<td/>元素
					td.appendTo(tr);
					var div = $("<div/>");
					var img = $("<img/>");
					div.append(img);
					$("<br/>").appendTo(div);
					$("<span/>").html(this.x+"排"+this.y+"号").appendTo(div);
					$("<br/>").appendTo(div);
					$("<span/>").attr("class","seat_price").html("￥"+this.price).appendTo(div);
					div.attr("class","seat_unavailable").appendTo(td);
				}else if(0<=this.price && this.price<250) {
					var td = $("<td/>");//创建一个<td/>元素
					td.appendTo(tr);
					var div = $("<div/>");
					var img = $("<img/>");
					div.append(img);
					$("<br/>").appendTo(div);
					$("<span/>").html(this.x+"排"+this.y+"号").appendTo(div);
					$("<br/>").appendTo(div);
					$("<span/>").attr("class","seat_price").html("￥"+this.price).appendTo(div);
					div.attr("class","seat_level_1").appendTo(td);
					var spid = this.id;var price = this.price;
					div.attr("id","spid"+spid);
					div.click(function(){
						func1(spid);
					});
				}else if(250<=this.price && this.price<500) {
					var td = $("<td/>");//创建一个<td/>元素
					td.appendTo(tr);
					var div = $("<div/>");
					var img = $("<img/>");
					div.append(img);
					$("<br/>").appendTo(div);
					$("<span/>").html(this.x+"排"+this.y+"号").appendTo(div);
					$("<br/>").appendTo(div);
					$("<span/>").attr("class","seat_price").html("￥"+this.price).appendTo(div);
					div.attr("class","seat_level_2").appendTo(td);
					var spid = this.id;var price = this.price;
					div.attr("id","spid"+spid);
					div.click(function(){
						func1(spid);
					});
				}else if(500<=this.price && this.price<750) {
					var td = $("<td/>");//创建一个<td/>元素
					td.appendTo(tr);
					var div = $("<div/>");
					var img = $("<img/>");
					div.append(img);
					$("<br/>").appendTo(div);
					$("<span/>").html(this.x+"排"+this.y+"号").appendTo(div);
					$("<br/>").appendTo(div);
					$("<span/>").attr("class","seat_price").html("￥"+this.price).appendTo(div);
					div.attr("class","seat_level_3").appendTo(td);
					var spid = this.id;var price = this.price;
					div.attr("id","spid"+spid);
					div.click(function(){
						func1(spid);
					});
				}else if(750<=this.price) {
					var td = $("<td/>");//创建一个<td/>元素
					td.appendTo(tr);
					var div = $("<div/>");
					var img = $("<img/>");
					div.append(img);
					$("<br/>").appendTo(div);
					$("<span/>").html(this.x+"排"+this.y+"号").appendTo(div);
					$("<br/>").appendTo(div);
					$("<span/>").attr("class","seat_price").html("￥"+this.price).appendTo(div);
					div.attr("class","seat_level_4").appendTo(td);
					var spid = this.id;var price = this.price;
					div.attr("id","spid"+spid);
					div.click(function(){
						func1(spid);
					});
				}
			});
			seat_table.append(tr);//tr放在tabel里面
		});
	});

	function func1(spid){
		var div = $("#spid"+spid);
		if(div.attr("class")!="seat_selected"){//选择座位
			var divs = $("div.seat_selected");
	        if(divs.length == 2) {
	        	alert("最多预订两张票！");
				return;
	        }
			div.attr("class", "seat_selected");
		}else {//退选座位
        	var money_text = div.children("span.seat_price").html();
        	var money = money_text.substring(1);
        	var m = Number(money);
        	if(0<=m && m<250) {
        		div.attr("class", "seat_level_1");
        	}else if(250<=m && m<500) {
        		div.attr("class", "seat_level_2");
        	}else if(500<=m && m<750) {
        		div.attr("class", "seat_level_3");
        	}else if(750<=m) {
        		div.attr("class", "seat_level_4");
        	}
		}

		
		
		var divs = $("div.seat_selected");
		var sum = 0.0;
		var selected_spids_str = "";
        for(var i=0;i<divs.length;i++) {
        	var money_text = divs.eq(i).children("span.seat_price").html();
        	var money = money_text.substring(1);
        	sum += Number(money);
        	selected_spids_str += divs.eq(i).attr("id").substring(4)+"-";
        }
        $("#total_price").html("￥"+sum);
        $("#selected_spids").val(selected_spids_str);
	}
	
	function validate1(f){
        if($("#selected_spids").val()==""){
        	alert("请选票！");
            return false;
		}
		$("#points_cost_input").val(500);
        return true;
	}
/*]]>*/
</script>

<!-- layui相关 -->
<link rel="stylesheet" th:href="@{/layui/css/layui.css}" media="all"/>
<script th:src="@{/layui/layui.js}" type="text/javascript"></script>
<script>
layui.use('element', function(){
  var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块
  
  //监听导航点击
  element.on('nav(demo)', function(elem){
    //console.log(elem)
    layer.msg(elem.text());
  });
});

</script>

<style type="text/css" th:inline="text">
#t1 {
	margin:0 auto;
	background-color:#393D49;
}
/*t2在水平上居中，且有宽度1000px*/
#t2 {
	width:1000px;
	margin:0 auto;/*t2在水平上居中*/
	position:relative;
}
#t3 {
	width:1000px;
	margin:0 auto;
}


.cover {
	width: 778px;
	height: 440px;
	margin-left:111px;
}

#price_level_div {
	width: 996px;
	height: 60px;
}
.price_level_span {
	margin-left: 70px;
}
.price_level_span img {
	width: 42px;
	height: 40px;
}


#seat_div {
	width: 996px;
	height: 400px;
	text-align:center;
	background-color:#eeeeee;
	overflow: scroll;/*里面的元素超出大小就会显示滚动条*/
}
#seat_table {
	margin:0 auto;/*居中*/
}
/*座位价格类型、是否可用、是否已经被选择*/
div.seat_level_1, div.seat_level_2, div.seat_level_3, div.seat_level_4, div.seat_selected, div.seat_unavailable {
	width: 60px;
	height: 80px;
	/*background-color:#eeee00;*/
	
	cursor:pointer; /*改鼠标样式*/
	display:block; /*将tr设置为块体元素*/
    margin:10px 10px 10px 10px;/*设置上、右、下、左外边距*/
    text-align: center; /*里面的元素水平居中*/
}
.seat_level_1 img {
	width: 42px;
	height: 40px;
	background:url(  [[@{/images/seat_level_1.png}]]  ) center;
}
.seat_level_2 img {
	width: 42px;
	height: 40px;
	background:url(  [[@{/images/seat_level_2.png}]]  ) center;
}
.seat_level_3 img {
	width: 42px;
	height: 40px;
	background:url(  [[@{/images/seat_level_3.png}]]  ) center;
}
.seat_level_4 img {
	width: 42px;
	height: 40px;
	background:url(  [[@{/images/seat_level_4.png}]]  ) center;
}
.seat_selected img {
	width: 42px;
	height: 40px;
	background:url(  [[@{/images/seat_selected.png}]]  ) center;
}
.seat_unavailable img {
	width: 42px;
	height: 40px;
	background:url(  [[@{/images/seat_unavailable.png}]]  ) center;
}

.seat_price {
	color:#ee0000;
}



.info_table{ 
}
.info_table td:nth-child(even) {
	background: #d8ebfa;
} 
.info_table td:nth-child(odd) {
	background: White;
}










.quan_div {
	width: 244px;
	height: 110px;
	background:url(  [[@{/images/quan-bg.png}]]  ) center;
}
.quan_name {
	margin-left:50px;
	color: White;
}
.points_cost {
	margin-left:80px;
	color: White;
}

</style>
</head>
<body>

<div id="t1">
<div id="t2">
<ul class="layui-nav">
  <li class="layui-nav-item layui-this"><a th:href="@{/user/indexV}">最新演出</a></li>
  <li class="layui-nav-item" th:if="${session.user}">
    <a href="javascript:;">我的订单</a>
    <dl class="layui-nav-child">
      <dd><a href="">全部订单</a></dd>
      <dd><a href="">未支付</a></dd>
      <dd><a href="">已支付</a></dd>
      <dd><a href="">已完成</a></dd>
      <dd><a href="">已取消</a></dd>
    </dl>
  </li>
</ul>
<ul class="layui-nav layui-layout-right" th:unless="${session.user}">
  <li class="layui-nav-item"><a th:href="@{/user/loginV}">登录</a></li>
  <li class="layui-nav-item"><a th:href="@{/user/regV}">注册</a></li>
</ul>
<ul class="layui-nav layui-layout-right" th:if="${session.user}">
   <li class="layui-nav-item">
    <a href="">系统消息<span class="layui-badge">9</span></a>
  </li>
  <li class="layui-nav-item" lay-unselect="" style="margin-right: 20px;">
    <a href="javascript:;"><img th:src="@{/faces/default.jpg}" class="layui-nav-img"/><font th:text="${session.user.nickname}"></font></a>
    <dl class="layui-nav-child">
      <dd><a href="javascript:;">修改信息</a></dd>
      <dd><a href="javascript:;">安全管理</a></dd>
      <dd><a href="javascript:;">充值</a></dd>
      <dd><a th:href="@{/user/logout}">退了</a></dd>
    </dl>
  </li>
</ul>
</div>
</div>

<div id="t3">
<br/>
<br/>
<img class="cover" th:src="@{/cover/}+${plan.cover}"/>
<br/>

<fieldset class="layui-elem-field">
  <legend><span class="title_span" th:text="${plan.name}"></span></legend>
  <div class="layui-field-box">
    <p class="introduction_span" th:text="${plan.introduction}"></p>
  </div>
</fieldset>

<fieldset class="layui-elem-field">
  <legend>基本信息</legend>
  <div class="layui-field-box">
    
    
<table class="info_table">
 	<tbody>
		<tr>
			<td width="90" class="bg">演出时间</td><td>2018.04.25-04.26</td>
			<td width="90" class="bg">演出场馆</td><td width="200">隆福剧场</td>
		</tr>
		<tr>
			<td width="90" class="bg">演出时间</td><td>2018.04.25-04.26</td>
			<td width="90" class="bg">演出场馆</td><td width="200">隆福剧场</td>
		</tr>
		<tr>
			<td width="90" class="bg">演出时间</td><td>2018.04.25-04.26</td>
			<td width="90" class="bg">演出场馆</td><td width="200">隆福剧场</td>
		</tr>
		<tr>
			<td width="90" class="bg">演出时间</td><td>2018.04.25-04.26</td>
			<td width="90" class="bg">演出场馆</td><td width="200">隆福剧场</td>
		</tr>
	</tbody>
</table>
    
    
  </div>
</fieldset>



<span class="timelabel">时间：</span><span class="starttime_span" th:text="${plan.starttime}"></span>&nbsp;&nbsp;~&nbsp;&nbsp;<span class="endtime_span" th:text="${plan.endtime}"></span>
<br/>
<span class="citylabel">城市：</span><span class="location_span" th:text="${plan.location}"></span>
<br/>
<span class="typelabel">类型：</span><span class="type_span" th:text="${plan.type}"></span>
<br/>
<span class="typelabel">场馆名：</span><span class="type_span" th:text="${venue.name}"></span>
<br/>
<span class="typelabel">场馆地址：</span><span class="type_span" th:text="${venue.address}"></span>
<br/>
<a th:href="@{/user/loadgoods}+'?planid='+${plan.id}">预订周边产品</a>
<br/>
<span class="typelabel">座位详情：</span>
<br/>
<br/>
<div id="price_level_div">
<span class="price_level_span"><img th:src="@{/images/seat_level_1.png}"/><span class="seat_price">￥0~￥250</span></span>
<span class="price_level_span"><img th:src="@{/images/seat_level_2.png}"/><span class="seat_price">￥250~￥500</span></span>
<span class="price_level_span"><img th:src="@{/images/seat_level_3.png}"/><span class="seat_price">￥500~￥750</span></span>
<span class="price_level_span"><img th:src="@{/images/seat_level_4.png}"/><span class="seat_price">￥750及以上</span></span>
<span class="price_level_span"><img th:src="@{/images/seat_unavailable.png}"/><span class="seat_price">不可用</span></span>
</div>
<div id="seat_div">
<table id="seat_table">
</table>
</div>


<span id="total_price" class="seat_price">￥0</span>
<form th:action="@{/user/preorder}" onsubmit="return validate1(this)" method="post">
<br/>
<div class="layui-collapse" lay-accordion="">
  <div class="layui-colla-item">
    <h2 class="layui-colla-title">使用优惠券</h2>
    <div class="layui-colla-content">
    	<div class="quan_div">
    		<span class="quan_name">5%折扣优惠券</span>
			<br/>
    		<span class="points_cost">-500积分</span>
    	</div>
    </div>
  </div>
</div>
<input id="selected_spids" type="hidden" name="spids"/>
<input id="points_cost_input" type="hidden" name="points_cost"/>
<button class="layui-btn layui-btn-normal layui-btn-radius preoder_btn">预订</button>
</form>
<br/>
<br/>
<br/>
<br/>
</div>


</body>
</html>